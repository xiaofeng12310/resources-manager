{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nexport default {\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || {}),\n      // 这里修复了括号问题\n      trainingList: [],\n      // 可报名培训列表\n      myApplyList: [],\n      // 我的报名记录\n      allApplyList: [] // 所有报名记录（管理员）\n    };\n  },\n  methods: {\n    formatTime(row, column, cellValue) {\n      if (!cellValue) return '无';\n      // 如果是 ISO 8601 格式（如 \"2025-04-07T06:11:26.000+00:00\"）\n      const date = new Date(cellValue);\n      // 转为本地时间格式：YYYY-MM-DD HH:mm:ss\n      return date.toLocaleString('zh-CN', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit',\n        hour12: false // 24小时制\n      }).replace(/\\//g, '-').replace(/,/g, '');\n    },\n    // 加载培训列表\n    loadTrainings() {\n      this.$request.get('/training').then(res => {\n        this.trainingList = res.data.map(item => ({\n          ...item,\n          applied: false // 需要后端接口判断\n        }));\n      });\n    },\n    // 加载我的报名\n    loadMyApply() {\n      this.$request.get('/training/apply/my').then(res => {\n        this.myApplyList = res.data;\n        // 标记已报名项目\n        this.trainingList.forEach(item => {\n          item.applied = this.myApplyList.some(a => a.trainingId === item.id);\n        });\n      });\n    },\n    // 加载所有报名（管理员）\n    loadAllApply() {\n      this.$request.get('/training/apply').then(res => {\n        this.allApplyList = res.data;\n      });\n    },\n    // 点击报名\n    handleApply(row) {\n      this.$request.post('/training/apply', {\n        trainingId: row.id\n      }).then(() => {\n        this.$message.success('报名成功');\n        this.loadMyApply();\n      });\n    },\n    // 状态变更（管理员）\n    handleStatusChange(row) {\n      this.$request.put('/training/apply', row).then(() => {\n        this.$message.success('状态已更新');\n      });\n    }\n  },\n  mounted() {\n    // 1. 所有用户都加载可报名的培训列表\n    this.loadTrainings();\n\n    // 2. 根据角色加载不同的数据\n    if (this.user.role === 'ADMIN' || this.user.level === '主管') {\n      this.loadAllApply(); // 管理员/主管：加载所有报名记录\n    } else {\n      this.loadMyApply(); // 普通员工：加载自己的报名记录\n    }\n  }\n};","map":{"version":3,"names":["data","user","JSON","parse","localStorage","getItem","trainingList","myApplyList","allApplyList","methods","formatTime","row","column","cellValue","date","Date","toLocaleString","year","month","day","hour","minute","second","hour12","replace","loadTrainings","$request","get","then","res","map","item","applied","loadMyApply","forEach","some","a","trainingId","id","loadAllApply","handleApply","post","$message","success","handleStatusChange","put","mounted","role","level"],"sources":["src/views/manager/TrainingApply.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- 普通员工视图 -->\r\n    <template v-if=\"user.level === '员工'\">\r\n      <el-table :data=\"trainingList\" border stripe>\r\n        <el-table-column prop=\"name\" label=\"培训名称\"></el-table-column>\r\n        <el-table-column prop=\"time\" label=\"时间\" width=\"180\"></el-table-column>\r\n        <el-table-column prop=\"location\" label=\"地点\"></el-table-column>\r\n        <el-table-column label=\"操作\" width=\"120\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button\r\n                type=\"primary\"\r\n                size=\"mini\"\r\n                @click=\"handleApply(scope.row)\"\r\n                :disabled=\"scope.row.applied\"\r\n            >{{ scope.row.applied ? '已报名' : '报名' }}</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 我的报名记录 -->\r\n      <el-divider content-position=\"left\">我的报名记录</el-divider>\r\n      <el-table :data=\"myApplyList\" border>\r\n        <el-table-column prop=\"trainingName\" label=\"培训项目\"></el-table-column>\r\n        <el-table-column prop=\"applyTime\" label=\"报名时间\" width=\"180\" :formatter=\"formatTime\"></el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag :type=\"scope.row.status === '已通过' ? 'success' : 'warning'\">\r\n              {{ scope.row.status }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </template>\r\n\r\n    <!-- 管理员视图 -->\r\n    <template v-else-if=\"user.role === 'ADMIN' || user.level === '主管'\">\r\n      <el-table :data=\"allApplyList\">\r\n        <el-table-column prop=\"employeeName\" label=\"员工姓名\" />\r\n        <el-table-column prop=\"trainingName\" label=\"培训项目\" />\r\n        <el-table-column label=\"状态\">\r\n          <template slot-scope=\"scope\">\r\n            <el-select v-model=\"scope.row.status\" @change=\"handleStatusChange(scope.row)\">\r\n              <el-option label=\"已报名\" value=\"已报名\" />\r\n              <el-option label=\"已通过\" value=\"已通过\" />\r\n              <el-option label=\"已拒绝\" value=\"已拒绝\" />\r\n            </el-select>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </template>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem('xm-user') || {}),  // 这里修复了括号问题\r\n      trainingList: [],    // 可报名培训列表\r\n      myApplyList: [],    // 我的报名记录\r\n      allApplyList: []    // 所有报名记录（管理员）\r\n    }\r\n  },\r\n  methods: {\r\n    formatTime(row, column, cellValue) {\r\n      if (!cellValue) return '无';\r\n      // 如果是 ISO 8601 格式（如 \"2025-04-07T06:11:26.000+00:00\"）\r\n      const date = new Date(cellValue);\r\n      // 转为本地时间格式：YYYY-MM-DD HH:mm:ss\r\n      return date.toLocaleString('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit',\r\n        hour12: false // 24小时制\r\n      }).replace(/\\//g, '-').replace(/,/g, '');\r\n    },\r\n    // 加载培训列表\r\n    loadTrainings() {\r\n      this.$request.get('/training').then(res => {\r\n        this.trainingList = res.data.map(item => ({\r\n          ...item,\r\n          applied: false  // 需要后端接口判断\r\n        }))\r\n      })\r\n    },\r\n    // 加载我的报名\r\n    loadMyApply() {\r\n      this.$request.get('/training/apply/my').then(res => {\r\n        this.myApplyList = res.data\r\n        // 标记已报名项目\r\n        this.trainingList.forEach(item => {\r\n          item.applied = this.myApplyList.some(a => a.trainingId === item.id)\r\n        })\r\n      })\r\n    },\r\n    // 加载所有报名（管理员）\r\n    loadAllApply() {\r\n      this.$request.get('/training/apply').then(res => {\r\n        this.allApplyList = res.data\r\n      })\r\n    },\r\n    // 点击报名\r\n    handleApply(row) {\r\n      this.$request.post('/training/apply', { trainingId: row.id }).then(() => {\r\n        this.$message.success('报名成功')\r\n        this.loadMyApply()\r\n      })\r\n    },\r\n    // 状态变更（管理员）\r\n    handleStatusChange(row) {\r\n      this.$request.put('/training/apply', row).then(() => {\r\n        this.$message.success('状态已更新')\r\n      })\r\n    }\r\n  },\r\n  mounted() {\r\n    // 1. 所有用户都加载可报名的培训列表\r\n    this.loadTrainings();\r\n\r\n    // 2. 根据角色加载不同的数据\r\n    if (this.user.role === 'ADMIN' || this.user.level === '主管') {\r\n      this.loadAllApply(); // 管理员/主管：加载所有报名记录\r\n    } else {\r\n      this.loadMyApply();  // 普通员工：加载自己的报名记录\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-divider {\r\n  margin: 20px 0;\r\n}\r\n.el-table {\r\n  margin-top: 10px;\r\n}\r\n</style>"],"mappings":";;;;AAuDA;EACAA,KAAA;IACA;MACAC,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MAAA;MACAC,YAAA;MAAA;MACAC,WAAA;MAAA;MACAC,YAAA;IACA;EACA;EACAC,OAAA;IACAC,WAAAC,GAAA,EAAAC,MAAA,EAAAC,SAAA;MACA,KAAAA,SAAA;MACA;MACA,MAAAC,IAAA,OAAAC,IAAA,CAAAF,SAAA;MACA;MACA,OAAAC,IAAA,CAAAE,cAAA;QACAC,IAAA;QACAC,KAAA;QACAC,GAAA;QACAC,IAAA;QACAC,MAAA;QACAC,MAAA;QACAC,MAAA;MACA,GAAAC,OAAA,aAAAA,OAAA;IACA;IACA;IACAC,cAAA;MACA,KAAAC,QAAA,CAAAC,GAAA,cAAAC,IAAA,CAAAC,GAAA;QACA,KAAAvB,YAAA,GAAAuB,GAAA,CAAA7B,IAAA,CAAA8B,GAAA,CAAAC,IAAA;UACA,GAAAA,IAAA;UACAC,OAAA;QACA;MACA;IACA;IACA;IACAC,YAAA;MACA,KAAAP,QAAA,CAAAC,GAAA,uBAAAC,IAAA,CAAAC,GAAA;QACA,KAAAtB,WAAA,GAAAsB,GAAA,CAAA7B,IAAA;QACA;QACA,KAAAM,YAAA,CAAA4B,OAAA,CAAAH,IAAA;UACAA,IAAA,CAAAC,OAAA,QAAAzB,WAAA,CAAA4B,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,UAAA,KAAAN,IAAA,CAAAO,EAAA;QACA;MACA;IACA;IACA;IACAC,aAAA;MACA,KAAAb,QAAA,CAAAC,GAAA,oBAAAC,IAAA,CAAAC,GAAA;QACA,KAAArB,YAAA,GAAAqB,GAAA,CAAA7B,IAAA;MACA;IACA;IACA;IACAwC,YAAA7B,GAAA;MACA,KAAAe,QAAA,CAAAe,IAAA;QAAAJ,UAAA,EAAA1B,GAAA,CAAA2B;MAAA,GAAAV,IAAA;QACA,KAAAc,QAAA,CAAAC,OAAA;QACA,KAAAV,WAAA;MACA;IACA;IACA;IACAW,mBAAAjC,GAAA;MACA,KAAAe,QAAA,CAAAmB,GAAA,oBAAAlC,GAAA,EAAAiB,IAAA;QACA,KAAAc,QAAA,CAAAC,OAAA;MACA;IACA;EACA;EACAG,QAAA;IACA;IACA,KAAArB,aAAA;;IAEA;IACA,SAAAxB,IAAA,CAAA8C,IAAA,qBAAA9C,IAAA,CAAA+C,KAAA;MACA,KAAAT,YAAA;IACA;MACA,KAAAN,WAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}